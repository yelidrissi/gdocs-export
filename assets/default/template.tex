% Docs in  http://www.tex.ac.uk/ctan/macros/latex/contrib/memoir/memman.pdf

\documentclass[letterpaper,oldfontcommands,11pt,extrafontsizes,onecolumn,oneside,openboth,final,titlepage]{memoir}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\usepackage[dvipsnames]{xcolor}  % Allows the definition of hex colors
% use microtype if available
\IfFileExists{microtype.sty}{\usepackage{microtype}}{}
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\usepackage[utf8]{inputenc}
\usepackage{eurosym}
% used for printing google docs templates
\usepackage{longtable}
% used for printing google docs images
\usepackage{graphicx}
% to support underlining, see http://tex.stackexchange.com/questions/13377/how-can-i-underline-a-single-word-with-latex
\usepackage[normalem]{ulem}
% used for google docs links
\usepackage[unicode=true]{hyperref}

\input{metadata.tex}

\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor=, %TODO: fix the author
            pdftitle=\mytitle,
            colorlinks=true,
            urlcolor=blue,
            linkcolor=magenta,
            pdfborder={0 0 0}}

% reduce page margins to a reasonable size
\setlrmarginsandblock{2.5cm}{2.5cm}{*}
\setulmarginsandblock{2.5cm}{2.5cm}{*}
\setlength{\footskip}{1.2cm}
\checkandfixthelayout

% customize header and footer
\nouppercaseheads
\makepagestyle{mystyle}
\pagestyle{mystyle}
\aliaspagestyle{chapter}{mystyle}

\ifdefined\myheader
  \makeheadrule{mystyle}{\textwidth}{0.5pt}
  \makeoddhead{mystyle}{}{}{\color{Gray}\itshape\myheader}
\fi

\ifdefined\myfooter
  \makeoddfoot{mystyle}{\myfooter}{}{\thepage/\thelastpage}
\else
  \makeoddfoot{mystyle}{}{}{\thepage/\thelastpage}
\fi
\makefootrule{mystyle}{\textwidth}{0.5pt}{0ex}

\makeheadfootruleprefix{mystyle}{\color{Gray}}{\color{Gray}}

\chapterstyle{komalike} % also consider article

% We will generate all images so they have a width \maxwidth. This means
% that they will get their normal width if they fit onto the page, but
% are scaled down if they would overflow the margins.
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
\else\Gin@nat@width\fi}
\makeatother
\let\Oldincludegraphics\includegraphics
% The line below breaks the way that pandoc converts image metadata in unexpected ways.
%\renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=\maxwidth]{#1}}

% Uncomment to make embedded links print out HREF in footnotes, good for printing
% \renewcommand{\href}[2]{#2\footnote{\url{#1}}}

\setlength{\parindent}{0pt}
\setlength{\parskip}{7pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines

% Limits depth of automatic numbering of headings.
% 0 => Only H1 (chapters), 1 => Up to H2 (sections), 2 => Up to H3 (subsections)
\setcounter{secnumdepth}{2}

% memoir specific variable that lowers the title by 200pt
\setlength{\droptitle}{200pt}

% customize size and alignment of title and subtitle
\pretitle{\begin{flushleft}}
\title{\bfseries \HUGE \mytitle \\ \vskip .5em \LARGE \mysubtitle}
\posttitle{\par\vskip1em{\normalfont\normalsize\scshape \par\vfill}\end{flushleft}\vskip 0.5em}

% TODO generate the author somehow
% \author{}

% Suppress printing todays date.
% TODO: currently looks bad if not blank; make it look good and replace with todays date
\date{}

\begin{document}

\input{header.tex}

\setcounter{tocdepth}{1}
\begin{KeepFromToc}
  \hypersetup{linkcolor=black}
  \tableofcontents
\end{KeepFromToc}
\pagebreak

\input{main.tex}

\end{document}
